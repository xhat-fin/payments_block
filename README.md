# Система управления блокировкой платежей

## Общее описание системы

Система предназначена для управления блокировкой платежей юридических лиц.

---

## Структура базы данных

### Таблица `clients`
| Поле              | Тип                 | Описание                        | Ограничения                     |
| ----------------- | ------------------- | ------------------------------- | ------------------------------- |
| id                | INTEGER PRIMARY KEY | ID клиента                      | AUTOINCREMENT                   |
| unp               | TEXT                | Уникальный номер плательщика    | UNIQUE, NOT NULL                |
| status_block      | BOOLEAN             | Статус блокировки               | DEFAULT FALSE (не заблокирован) |
| current_reason_id | INTEGER             | ID последней причины блокировки | FOREIGN KEY                     |

### Таблица `reason_blocks`
| Поле         | Тип                 | Описание              | Ограничения                              |
| ------------ | ------------------- | --------------------- | ---------------------------------------- |
| id           | INTEGER PRIMARY KEY | ID причины блокировки | AUTOINCREMENT                            |
| reason_title | TEXT                | Название причины      | NOT NULL                                 |
| is_fraud     | BOOLEAN             | Признак мошенничества | DEFAULT FALSE (не мошенническая причина) |

### Таблица `log_blocks_payments`
| Поле | Тип | Описание | Ограничения |
|------|-----|----------|-------------|
| id | INTEGER PRIMARY KEY | Уникальный идентификатор | AUTOINCREMENT |
| status_block | BOOLEAN | Статус блокировки | NOT NULL |
| reason_id | INTEGER | ID причины | FOREIGN KEY, NULLABLE |
| client_id | INTEGER | ID клиента | FOREIGN KEY, NOT NULL |
| author_id | INTEGER | ID сотрудника | FOREIGN KEY, NOT NULL |
| created_at | TIMESTAMP | Время операции | DEFAULT CURRENT_TIMESTAMP |

### Таблица `users`
| Поле | Тип | Описание | Ограничения |
|------|-----|----------|-------------|
| id | INTEGER PRIMARY KEY | Уникальный идентификатор | AUTOINCREMENT |
| username | TEXT | Имя пользователя | |


В таблицу users создается тестовый пользователь, от лица которого будут дергаться все API. 
ID тестового пользователя = 1 и добавляется в условную сессию при запуске FastAPI app.

---

## REST API Endpoints

### **Клиенты** (`/api/clients/`)

#### `POST /api/clients/{unp}`
- **Описание**: Создание нового клиента
- **Параметры**: `unp` (передается в url)

#### `GET /api/clients/{unp}`
- **Описание**: Получение информации о клиенте
- **Параметры**: `unp` (передается в url)

#### `GET /api/clients/`
- **Описание**: Получение списка всех клиентов

### **Блокировки**

#### `POST /api/clients/{unp}/block`
- **Описание**: Блокировка платежей клиента
- **Request body**: `{"reason_id": int}`

#### `POST /api/clients/{unp}/unblock`
- **Описание**: Разблокировка платежей клиента

### **Логи и аудит** (`/api/clients/log/`)

#### `GET /api/clients/log/{unp}`
- **Описание**: История операций по клиенту

###  **Причины блокировок** (`/api/reasons/`)

#### `GET /api/reasons/`
- **Описание**: Получение списка всех причин
- **Ответ**: Массив причин блокировок

#### `POST /api/reasons/`
- **Описание**: Создание новой причины блокировки
- **Тело запроса**: `{"reason_title": str, "is_fraud": bool}`
- **Ответ**: Данные созданной причины
- **Ошибки**: 500 (ошибка создания)
